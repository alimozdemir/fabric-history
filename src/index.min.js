var originalFn,originalFn;fabric.Canvas.prototype.initialize=(originalFn=fabric.Canvas.prototype.initialize,function(...t){return originalFn.call(this,...t),this._historyInit(),this}),fabric.Canvas.prototype.dispose=(originalFn=fabric.Canvas.prototype.dispose,function(...t){return originalFn.call(this,...t),this._historyDispose(),this}),fabric.Canvas.prototype._historyNext=function(){return JSON.stringify(this.toDatalessJSON(this.extraProps))},fabric.Canvas.prototype._historyEvents=function(){return{"object:added":t=>this._historySaveAction(t),"object:removed":t=>this._historySaveAction(t),"object:modified":t=>this._historySaveAction(t),"object:skewing":t=>this._historySaveAction(t)}},fabric.Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.extraProps=["selectable","editable"],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},fabric.Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},fabric.Canvas.prototype._historySaveAction=function(t){if(!this.historyProcessing&&(!t||t.target&&!t.target.excludeFromExport)){let i=this._historyNext();this.historyUndo.push(i),this.historyNextState=this._historyNext(),this.fire("history:append",{json:i})}},fabric.Canvas.prototype.undo=function(t){this.historyProcessing=!0;let i=this.historyUndo.pop();i?(this.historyRedo.push(this._historyNext()),this.historyNextState=i,this._loadHistory(i,"history:undo",t)):this.historyProcessing=!1},fabric.Canvas.prototype.redo=function(t){this.historyProcessing=!0;let i=this.historyRedo.pop();i?(this.historyUndo.push(this._historyNext()),this.historyNextState=i,this._loadHistory(i,"history:redo",t)):this.historyProcessing=!1},fabric.Canvas.prototype._loadHistory=function(t,i,o){var s=this;this.loadFromJSON(t,function(){s.renderAll(),s.fire(i),s.historyProcessing=!1,o&&"function"==typeof o&&o()})},fabric.Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},fabric.Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()},fabric.Canvas.prototype.canUndo=function(){return this.historyUndo.length>0},fabric.Canvas.prototype.canRedo=function(){return this.historyRedo.length>0},fabric.Canvas.prototype.offHistory=function(){this.historyProcessing=!0};
